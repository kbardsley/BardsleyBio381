---
title: "Homework 8"
author: "Katie Bardsley"
date: "3/31/2021"
output:
  prettydoc::html_pretty:
    theme: architect
    highlight: github
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
```

### Creating Fake Data Sets to Explore Hypothesis

#### 1. Budbreak data set

Here I will be focusing on bud flush phenology in poplar, thinking about patterns similar to those being studied in the Keller Lab currently. In a common garden, you might expect samples taken from colder climates to break bud earlier than those from warmer climates as they have a shorter growing season and need to take advantage of all the warm days they can get. 

#### 2. Setting initial parameters

```{r}
# cold source climate
n_cold <- 500
mean_cold <- 125
var_cold <- 300
  
# warm source climate
n_warm <- 500
mean_warm <- 140
var_warm <- 300

```

#### 3. Generating random data and setting it up in a data frame

```{r}

###################################
# FUNCTION: RandomBudbreakData
# description: generate random budbreak data and organize in data frame
# inputs: n, mean, and variance for each treatement
# outputs: dataframe
# ---------------------------------
RandomBudbreakData <- function(n_cold, mean_cold, var_cold, n_warm, mean_warm, var_warm){
  data_cold <- rnorm(n=n_cold, mean=mean_cold, sd=sqrt(var_cold))
  data_warm <- rnorm(n=n_warm, mean=mean_warm, sd=sqrt(var_warm))

# combine into one big data frame
  cold <- data.frame(1:n_cold, data_cold, rep("cold", n_cold))
  colnames(cold) <- c("ID", "BudBreakDay","Climate")
  warm <- data.frame((n_cold+1):(n_cold+n_warm), data_warm, rep("warm", n_cold))
  colnames(warm) <- c("ID", "BudBreakDay","Climate")
  budbreak_data <- rbind(cold, warm)
  return(budbreak_data)
} # end of RandomBudbreakData

###################################

data <- RandomBudbreakData(n_cold, mean_cold, var_cold, n_warm, mean_warm, var_warm)

```

#### 4. Creating anova model and plotting data

```{r}
mod <- aov(BudBreakDay ~ Climate, data=data)
summary(mod)
```

```{r}
ggplot(data=data, mapping=aes(y=BudBreakDay, fill=Climate)) + geom_boxplot() + 
  labs(title="Julian days before budbreak for poplar samples from different climates", 
       y="Julian days before budbreak") + 
  theme_minimal()
```

#### 5. Running again, this time with a different set of random numbers

Repeat with same parameters and different sets of random numbers.

```{r}
data <- RandomBudbreakData(n_cold, mean_cold, var_cold, n_warm, mean_warm, var_warm)

mod <- aov(BudBreakDay ~ Climate, data=data)
summary(mod)

```

#### 6. Changing the means for the two groups

Make the mean bud break at day 130 instead of 140 so that there is less of a difference between the two groups.

```{r}
# cold source climate
mean_cold <- 125

# warm source climate
mean_warm <- 130

data <- RandomBudbreakData(n_cold, mean_cold, var_cold, n_warm, mean_warm, var_warm)

mod <- aov(BudBreakDay ~ Climate, data=data)
summary(mod)
```

We still see significance, so bring it up to 128 for the mean budbreak in the warm climate.

```{r}
# cold source climate
mean_cold <- 128

# warm source climate
mean_warm <- 130

data <- RandomBudbreakData(n_cold, mean_cold, var_cold, n_warm, mean_warm, var_warm)

mod <- aov(BudBreakDay ~ Climate, data=data)
summary(mod)
```

Here we stop seeing significance.

#### 7. Changing the sample sizes

Play with different sample sizes

```{r}
# cold source climate
mean_cold <- 125
var_cold <- 300
  
# warm source climate
mean_warm <- 140
var_warm <- 300

# try playing with different sample sizes
sample_sizes <- c(10, 20, 30, 40, 50, 100, 200, 400, 500, 1000)
mean <- rep(999, length(sample_sizes))
count <- 1

for (n in sample_sizes){
  n_warm <- n/2
  n_cold <- n/2
  pval <- rep(999, 100)
  for (i in 1:100){
    data <- RandomBudbreakData(n_cold, mean_cold, var_cold, n_warm, mean_warm, var_warm)
    mod <- aov(BudBreakDay ~ Climate, data=data)
    summary<- summary(mod)
    pval[i] <- summary[[1]]$`Pr(>F)`[1]  # save p-value
  }
  mean[count] <- signif(mean(pval), digits=3)
  count <- count + 1
  
}
means <- data.frame(sample_sizes/2, mean)
colnames(means) <- c("Number of samples in each treatment", 
                     "Mean p-value across 100 iterations")
print(means)

```




# Write up your results in a markdown file, organized with headers and different code chunks to show your analysis. Be explicit in your explanation and justification for sample sizes, means, and variances.


